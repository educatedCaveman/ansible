---
- name: configure GitLab
  hosts:
    - moria
  roles:
    - VM_role
    - git_dotfiles_role
    - git_scripts_role
    - VM_netplan_MTU
    - apt_client_role
    - linux_role
    - drake_role
  vars:
    - driver_file:  "/home/drake/NVIDIA-Linux-x86_64-460.67.run"
    - driver_url: "https://international.download.nvidia.com/XFree86/Linux-x86_64/460.67/NVIDIA-Linux-x86_64-460.67.run"
  tasks:

    # nvidia driver
    - name: check for the driver being present already
      stat:
        path: "{{ driver_file }}"
      register: driver

    - name: retrieving the nVidia driver
      get_url:
        url:  "{{ driver_url }}"
        dest: "{{ driver_file }}"
      when: not driver.stat.exists

    - name: add execute permissions
      file:
        path: "{{ driver_file }}"
        mode: a+x
      when: not driver.stat.exists

# TODO: trex miner
# also set up custom run script?

# TODO: special tmux.conf


# debug messages:
    - name: driver versions
      debug:
        msg: 
          - "the following driver versions may be out of date."
          - "check the following URL for the latest version:"
          - "https://www.nvidia.com/Download/index.aspx?lang=en-us"

      