---
- name: configure NextCloud
  hosts:
    - nextcloud
  roles:
    - VM_role
    - git_dotfiles_role
    - git_scripts_role
    - VM_netplan_MTU
    - apt_client_role
    - linux_role
    - drake_role
    - nfs_base_role
    - nfs_docs_role
    - nfs_pics_role
  tasks:

  # install nextcloud snap
  - name: install NextCloud snap
    community.general.snap:
      name:
        - nextcloud

  # setup the following NFS links:
  - name: link Documents to nextcloud
    file:
      src:  /mnt/mobius/Documents
      dest: /var/snap/nextcloud/common/nextcloud/data/Documents
      state:  link

  - name: link Pictures to nextcloud
    file:
      src:  /mnt/mobius/Pictures
      dest: /var/snap/nextcloud/common/nextcloud/data/Pictures
      state:  link

#     #NFS path check
#     - name: create NFS folder
#       file:
#         path: /var/snap/nextcloud/common/nextcloud/data
#         state:  directory

#     - name: check for NFS folder
#       stat:
#         path: /var/snap/nextcloud/common/nextcloud/data
#       register: nextcloud

#     #mount the Documents share
#     - name: Mount the Documents share... 
#       mount:
#         src: 192.168.11.2:/mnt/storage_node/Documents
#         path: /var/snap/nextcloud/common/nextcloud/data/Documents
#         fstype: nfs 
#         opts: rw,nolock,tcp
#         state: mounted
#       when: nextcloud.stat.exists

#     #mount the Pictures share
#     - name: Mount the Pictures share... 
#       mount:
#         src: 192.168.11.2:/mnt/storage_node/Pictures
#         path: /var/snap/nextcloud/common/nextcloud/data/Pictures
#         fstype: nfs 
#         opts: rw,nolock,tcp
#         state: mounted
#       when: nextcloud.stat.exists
  - name: manually configure the snap
    debug:
      - "the first time this is run on a host, look through the following guide"
      - "for configuration steps:"
      - "https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-nextcloud-on-ubuntu-20-04"
      - ""
      - "after doing the config, run the following:"
      - "sudo snap restart nextcloud"
