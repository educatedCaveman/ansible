---

#some command taken from:
#https://www.cyberciti.biz/faq/ansible-apt-update-all-packages-on-ubuntu-debian-linux/

- name: configure node packages
  hosts: all
  tasks:

    - name: update packages
      apt:
        update_cache=yes
        force_apt_get=yes
        cache_valid_time=3600

    - name: upgrade packages
      apt:
        upgrade=dist
        force_apt_get=yes

    #this is where to list all packages needed
    - name: install core packages
      apt:
        pkg:
        - neovim
        - neofetch
        - zsh
        - tmux
        state: latest

    - name: check if a reboot is needed
      register: reboot_required_file
      stat: 
        path=/var/run/reboot-required 
        get_md5=no

    - name: reboot the node
      reboot:
        msg: "Reboot initiated by Ansible due to kernel updates"
        connect_timeout: 5
        reboot_timeout: 300
        pre_reboot_delay: 0
        post_reboot_delay: 30
        test_command: uptime
      when: reboot_required_file.stat.exists
